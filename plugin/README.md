# Figma Sheets Sync Plugin

이 플러그인은 Node.js 데이터 엔진 서버에서 생성한 패치를 Figma 문서에 적용합니다.

## 설치 방법

1. Figma 데스크톱 앱 또는 웹 앱을 엽니다.

2. 메뉴에서 `Plugins` > `Development` > `Import plugin from manifest...`를 선택합니다.

3. 이 디렉토리(`plugin`)를 선택하거나, `manifest.json` 파일을 선택합니다.

4. 플러그인이 플러그인 목록에 추가됩니다.

## 사용 방법

1. **데이터 엔진 서버 실행**

   프로젝트 루트에서:
   ```bash
   npm run server
   ```
   
   서버가 `http://localhost:4000`에서 실행됩니다.

2. **Figma에서 플러그인 실행**

   - Figma 파일을 엽니다.
   - `Plugins` > `Development` > `Figma Sheets Sync`를 선택합니다.
   - 플러그인 UI가 표시됩니다.

3. **패치 적용**

   - "데이터 엔진 URL" 필드에 서버 URL이 올바르게 입력되어 있는지 확인합니다.
     - 기본값: `http://localhost:4000/figma-patches`
   - "패치 불러와서 적용" 버튼을 클릭합니다.
   - 로그 영역에서 진행 상황을 확인할 수 있습니다.

## 작동 원리

1. 플러그인 UI가 데이터 엔진 서버(`/figma-patches`)에 HTTP 요청을 보냅니다.
2. 서버는 Google Sheets와 Figma 파일을 읽어서 패치 목록을 생성합니다.
3. 플러그인은 받은 패치 목록을 순회하면서:
   - 각 `nodeId`로 노드를 찾습니다.
   - 노드가 TEXT 타입인지 확인합니다.
   - 필요한 폰트를 로드합니다.
   - `textNode.characters`를 새로운 텍스트로 업데이트합니다.

## 문제 해결

### "노드를 찾을 수 없습니다" 오류

- Figma 파일이 데이터 엔진이 읽은 파일과 동일한지 확인하세요.
- 노드 ID가 변경되었을 수 있습니다. 데이터 엔진을 다시 실행하여 최신 노드 ID를 가져오세요.

### "폰트 로드 실패" 경고

- 해당 텍스트 노드에 사용된 폰트가 시스템에 설치되어 있지 않을 수 있습니다.
- 플러그인은 기본 폰트로 계속 진행하지만, 레이아웃이 변경될 수 있습니다.

### CORS 오류

- 데이터 엔진 서버가 실행 중인지 확인하세요.
- 서버의 CORS 설정이 올바른지 확인하세요 (`server.js` 참고).

